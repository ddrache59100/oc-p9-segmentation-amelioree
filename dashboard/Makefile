# Makefile pour l'application Streamlit Comparative P8 vs P9

# Variables
VENV_NAME = venv_streamlit_p9
PYTHON = python3.10
VENV_PYTHON = $(VENV_NAME)/bin/python
VENV_PIP = $(VENV_NAME)/bin/pip

# Configuration APIs
API_URL_P8_LOCAL = http://localhost:5000
API_URL_P8_AZURE = https://oc-p8-segmentation.azurewebsites.net
API_URL_P9_LOCAL = http://localhost:8000
API_URL_P9_AZURE = https://oc-p9-segformer.azurewebsites.net
STREAMLIT_PORT = 8502

# Azure
AZURE_APP_NAME = oc-p9-dashboard
AZURE_RESOURCE_GROUP = rg-p9-segformer

# Informations systÃ¨me
SHELL := /bin/bash
.DEFAULT_GOAL := help

.PHONY: help setup install run run-p8 run-p9 run-both test clean azure-deploy azure-prepare azure-update-env azure-restart azure-status azure-logs azure-test azure-destroy

help:
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘        Dashboard Comparatif Segmentation P8 vs P9            â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ğŸš€ DÃ‰MARRAGE RAPIDE:"
	@echo "  make setup              - Installation complÃ¨te"
	@echo "  make run-local          - Lancer avec APIs locales"
	@echo "  make run-azure          - Lancer avec APIs Azure"
	@echo "  make run-mixed          - API P8 Azure + API P9 locale"
	@echo ""
	@echo "ğŸ“¦ INSTALLATION:"
	@echo "  make venv               - CrÃ©er l'environnement virtuel"
	@echo "  make install            - Installer les dÃ©pendances"
	@echo "  make copy-images        - Copier les images de test"
	@echo ""
	@echo "ğŸ¯ MODES DE LANCEMENT:"
	@echo "  make run-local          - Tout en local (P8:5000, P9:8000)"
	@echo "  make run-azure          - Tout sur Azure"
	@echo "  make run-mixed          - Mode mixte (utile pour tests)"
	@echo "  make run-p8-only        - Tester uniquement P8"
	@echo "  make run-p9-only        - Tester uniquement P9"
	@echo ""
	@echo "â˜  AZURE - DÃ‰PLOIEMENT:"
	@echo "  make azure-deploy       - DÃ©ploiement complet sur Azure"
	@echo "  make azure-prepare      - PrÃ©parer le package de dÃ©ploiement"
	@echo "  make azure-update       - Mise Ã  jour rapide"
	@echo "  make azure-update-env   - MAJ variables d'environnement"
	@echo "  make azure-restart      - RedÃ©marrer l'app Azure"
	@echo ""
	@echo "â˜  AZURE - MONITORING:"
	@echo "  make azure-status       - VÃ©rifier le statut"
	@echo "  make azure-health       - Check santÃ© des 3 services"
	@echo "  make azure-logs         - Voir les logs en temps rÃ©el"
	@echo "  make azure-test         - Tester l'app dÃ©ployÃ©e"
	@echo ""
	@echo "â˜  AZURE - MAINTENANCE:"
	@echo "  make azure-stop         - ArrÃªter le dashboard (Ã©conomie)"
	@echo "  make azure-start        - RedÃ©marrer le dashboard"
	@echo "  make azure-stop-all     - ArrÃªter TOUS les services P8+P9"
	@echo "  make azure-start-all    - RedÃ©marrer TOUS les services"
	@echo "  make azure-destroy      - Supprimer le dashboard"
	@echo ""
	@echo "ğŸ§ª TESTS:"
	@echo "  make test               - Tests de syntaxe et imports"
	@echo "  make test-apis          - Tester la connexion aux APIs"
	@echo "  make test-local         - Tester en local complet"
	@echo ""
	@echo "ğŸ§¹ NETTOYAGE:"
	@echo "  make clean              - Nettoyer les fichiers temporaires"
	@echo "  make clean-all          - Tout nettoyer (incluant venv)"
	@echo ""
	@echo "ğŸ“Š COMPARAISON:"
	@echo "  make compare-local      - Comparaison avec APIs locales"
	@echo "  make compare-azure      - Comparaison avec APIs Azure"
	@echo "  make benchmark          - Benchmark complet P8 vs P9"

# Installation complÃ¨te
setup: venv install copy-images
	@echo "âœ… Installation terminÃ©e!"
	@echo ""
	@echo "ğŸš€ Pour dÃ©marrer:"
	@echo "  - APIs locales: make run-local"
	@echo "  - APIs Azure:   make run-azure"

# CrÃ©er le virtualenv
$(VENV_NAME):
	@echo "ğŸ”§ CrÃ©ation de l'environnement virtuel Python $(PYTHON)..."
	@which $(PYTHON) > /dev/null || (echo "âŒ Erreur: $(PYTHON) n'est pas installÃ©" && exit 1)
	$(PYTHON) -m venv $(VENV_NAME)
	@echo "âœ… Environnement virtuel crÃ©Ã©"

venv: $(VENV_NAME)

# Installer les dÃ©pendances
install: $(VENV_NAME)
	@echo "ğŸ“¦ Installation des dÃ©pendances..."
	$(VENV_PIP) install --upgrade pip
	@echo "ğŸ“š Installation des packages Streamlit..."
	$(VENV_PIP) install streamlit==1.28.0
	$(VENV_PIP) install requests==2.31.0
	$(VENV_PIP) install Pillow==10.0.0
	$(VENV_PIP) install numpy==1.24.3
	$(VENV_PIP) install pandas==2.0.3
	$(VENV_PIP) install altair==5.0.1
	$(VENV_PIP) install streamlit-image-comparison==0.0.4
	@echo "âœ… DÃ©pendances installÃ©es"

# Copier les images de test
copy-images:
	@echo "ğŸ“¸ Copie des images de test..."
	@if [ -d "../projet8/app_web/test_images" ]; then \
		cp -r ../projet8/app_web/test_images .; \
		echo "âœ… Images P8 copiÃ©es"; \
	elif [ -d "../p8/test_images" ]; then \
		cp -r ../p8/test_images .; \
		echo "âœ… Images P8 copiÃ©es"; \
	else \
		echo "âš   Images P8 non trouvÃ©es, crÃ©ation d'exemples..."; \
		mkdir -p test_images; \
		echo '{"images": [], "description": "Images de test"}' > test_images/index.json; \
	fi

# ================== LANCEMENT LOCAL ==================

# Lancer avec les deux APIs en local
run-local: $(VENV_NAME)
	@echo "ğŸš€ Lancement du dashboard (APIs locales)..."
	@echo "ğŸ“ Dashboard: http://localhost:$(STREAMLIT_PORT)"
	@echo "ğŸ”— API P8: $${API_URL_P8}"
	@echo "ğŸ”— API P9: $${API_URL_P9}"
	@echo ""
	@echo "âš   Assurez-vous que les APIs sont lancÃ©es:"
	@echo "  Terminal P8: cd ../projet8/api && make run-h5"
	@echo "  Terminal P9: cd ../projet9_api && make run-b1-fp32"
	@echo ""
	API_URL_P8=$(API_URL_P8) API_URL_P9=$(API_URL_P9) \
		$(VENV_PYTHON) -m streamlit run app_streamlit_comparative.py \
		--server.port $(STREAMLIT_PORT)

# Lancer avec les deux APIs sur Azure
run-azure: $(VENV_NAME)
	@echo "ğŸš€ Lancement du dashboard (APIs Azure)..."
	@echo "ğŸ“ Dashboard: http://localhost:$(STREAMLIT_PORT)"
	@echo "â˜  API P8: $(API_URL_P8_AZURE)"
	@echo "â˜  API P9: $(API_URL_P9_AZURE)"
	API_URL_P8=$(API_URL_P8_AZURE) API_URL_P9=$(API_URL_P9_AZURE) \
		$(VENV_PYTHON) -m streamlit run app_streamlit_comparative.py \
		--server.port $(STREAMLIT_PORT)

# Mode mixte: P8 Azure + P9 local
run-mixed: $(VENV_NAME)
	@echo "ğŸš€ Lancement du dashboard (mode mixte)..."
	@echo "ğŸ“ Dashboard: http://localhost:$(STREAMLIT_PORT)"
	@echo "â˜  API P8: $(API_URL_P8_AZURE)"
	@echo "ğŸ”— API P9: $(API_URL_P9_LOCAL) (local)"
	API_URL_P8=$(API_URL_P8_AZURE) API_URL_P9=$(API_URL_P9_LOCAL) \
		$(VENV_PYTHON) -m streamlit run app_streamlit_comparative.py \
		--server.port $(STREAMLIT_PORT)

# Tester uniquement P8
run-p8-only: $(VENV_NAME)
	@echo "ğŸš€ Test P8 uniquement..."
	API_URL_P8=$(API_URL_P8_AZURE) API_URL_P9="" \
		$(VENV_PYTHON) -m streamlit run app_streamlit_comparative.py \
		--server.port $(STREAMLIT_PORT)

# Tester uniquement P9
run-p9-only: $(VENV_NAME)
	@echo "ğŸš€ Test P9 uniquement..."
	API_URL_P8="" API_URL_P9=$(API_URL_P9_AZURE) \
		$(VENV_PYTHON) -m streamlit run app_streamlit_comparative.py \
		--server.port $(STREAMLIT_PORT)

# ================== TESTS ==================

# Tests basiques
test: $(VENV_NAME)
	@echo "ğŸ§ª Test de l'application..."
	@echo "1. VÃ©rification de la syntaxe..."
	@$(VENV_PYTHON) -m py_compile app_streamlit_comparative.py
	@echo "âœ… Syntaxe OK"
	@echo ""
	@echo "2. VÃ©rification des imports..."
	@$(VENV_PYTHON) -c "import streamlit; import requests; import pandas; import altair; print('âœ… Imports OK')"

# Tester la connexion aux APIs
test-apis: $(VENV_NAME)
	@echo "ğŸ” Test de connexion aux APIs..."
	@echo ""
	@echo "ğŸ“¡ Test API P8 (Azure):"
	@curl -s -w "   Status: %{http_code} - Temps: %{time_total}s\n" \
		$(API_URL_P8_AZURE)/health -o /dev/null || echo "   âŒ P8 non accessible"
	@echo ""
	@echo "ğŸ“¡ Test API P9 (Azure):"
	@curl -s -w "   Status: %{http_code} - Temps: %{time_total}s\n" \
		$(API_URL_P9_AZURE)/health -o /dev/null || echo "   âŒ P9 non accessible"

# Test local complet
test-local: test test-apis
	@echo ""
	@echo "âœ… Tests locaux terminÃ©s"

# ================== AZURE DEPLOYMENT ==================

# PrÃ©paration du package Azure
azure-prepare:
	@echo "ğŸ“¦ PrÃ©paration du package Azure..."
	@mkdir -p azure_deploy
	@mkdir -p azure_deploy/.streamlit
	@cp app.py azure_deploy/app.py
	@echo "ğŸ“ CrÃ©ation du requirements.txt..."
	@echo "streamlit==1.28.0" > azure_deploy/requirements.txt
	@echo "requests==2.31.0" >> azure_deploy/requirements.txt
	@echo "Pillow==10.0.0" >> azure_deploy/requirements.txt
	@echo "numpy==1.24.3" >> azure_deploy/requirements.txt
	@echo "pandas==2.0.3" >> azure_deploy/requirements.txt
	@echo "altair==5.0.1" >> azure_deploy/requirements.txt
	@echo "streamlit-image-comparison==0.0.4" >> azure_deploy/requirements.txt
	@echo "matplotlib==3.7.2" >> azure_deploy/requirements.txt
	@cp -r test_images azure_deploy/ 2>/dev/null || echo "âš   Images non trouvÃ©es"
	@echo "ğŸ”§ Configuration Streamlit pour Azure..."
	@echo "[server]" > azure_deploy/.streamlit/config.toml
	@echo "python -m streamlit run app.py --server.port 8000 --server.address 0.0.0.0" > azure_deploy/startup.txt
	@echo "port = 8000" >> azure_deploy/.streamlit/config.toml
	@echo "python -m streamlit run app.py --server.port 8000 --server.address 0.0.0.0" > azure_deploy/startup.txt
	@echo "enableCORS = false" >> azure_deploy/.streamlit/config.toml
	@echo "python -m streamlit run app.py --server.port 8000 --server.address 0.0.0.0" > azure_deploy/startup.txt
	@echo "enableXsrfProtection = true" >> azure_deploy/.streamlit/config.toml
	@echo "python -m streamlit run app.py --server.port 8000 --server.address 0.0.0.0" > azure_deploy/startup.txt
	@echo "[browser]" >> azure_deploy/.streamlit/config.toml
	@echo "python -m streamlit run app.py --server.port 8000 --server.address 0.0.0.0" > azure_deploy/startup.txt
	@echo "serverAddress = \"0.0.0.0\"" >> azure_deploy/.streamlit/config.toml
	@echo "python -m streamlit run app.py --server.port 8000 --server.address 0.0.0.0" > azure_deploy/startup.txt
	@echo "âœ… Package Azure prÃªt dans azure_deploy/"

# DÃ©ploiement complet Azure
azure-deploy: azure-prepare
	@echo "â˜  DÃ©ploiement du dashboard comparatif sur Azure..."
	@echo "âš   Note: Le dashboard nÃ©cessite que les APIs P8 et P9 soient dÃ©ployÃ©es"
	
	# Ã‰tape 1: DÃ©ployer l'application
	@echo "ğŸ“¤ DÃ©ploiement de l'application..."
	cd azure_deploy && az webapp up \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP) \
		--sku F1 \
		--runtime "python|3.10"
	
	# Ã‰tape 2: Configurer le dÃ©marrage
	@echo "âš™ï¸  Configuration du dÃ©marrage Streamlit..."
	az webapp config set \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP) \
		--startup-file "python -m streamlit run app.py --server.port 8000 --server.address 0.0.0.0"
	
	# Ã‰tape 3: Configurer les variables d'environnement
	@echo "ğŸ”§ Configuration des APIs..."
	az webapp config appsettings set \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP) \
		--settings \
		API_URL_P8="$(API_URL_P8_AZURE)" \
		API_URL_P9="$(API_URL_P9_AZURE)" \
		AZURE_DEPLOYMENT="true"
	
	# Ã‰tape 4: RedÃ©marrer
	@echo "â™»ï¸  RedÃ©marrage de l'application..."
	az webapp restart \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP)
	
	@echo ""
	@echo "âœ… Dashboard comparatif dÃ©ployÃ©!"
	@echo "ğŸŒ URL: https://$(AZURE_APP_NAME).azurewebsites.net"
	@echo ""
	@echo "ğŸ“Š Architecture complÃ¨te:"
	@echo "  Dashboard: https://$(AZURE_APP_NAME).azurewebsites.net"
	@echo "  API P8:    $(API_URL_P8_AZURE)"
	@echo "  API P9:    $(API_URL_P9_AZURE)"
	@echo ""
	@echo "â±ï¸  Le dashboard sera disponible dans ~60 secondes"

# Mise Ã  jour rapide
azure-update: azure-prepare
	@echo "ğŸ”„ Mise Ã  jour rapide du dashboard..."
	cd azure_deploy && zip -r ../app.zip . -q
	az webapp deployment source config-zip \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP) \
		--src app.zip
	rm app.zip
	@echo "âœ… Dashboard mis Ã  jour"

# Mise Ã  jour des variables d'environnement
azure-update-env:
	@echo "ğŸ”§ Mise Ã  jour des variables d'environnement..."
	az webapp config appsettings set \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP) \
		--settings \
		API_URL_P8="$(API_URL_P8_AZURE)" \
		API_URL_P9="$(API_URL_P9_AZURE)"
	@echo "âœ… Variables mises Ã  jour"
	@make azure-restart

# RedÃ©marrer l'application
azure-restart:
	@echo "â™»ï¸  RedÃ©marrage du dashboard..."
	az webapp restart \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP)
	@echo "âœ… Dashboard redÃ©marrÃ©"

# ================== MONITORING AZURE ==================

# Status du dashboard
azure-status:
	@echo "ğŸ“Š Statut du Dashboard Comparatif:"
	@echo ""
	@echo "ğŸ” Ã‰tat de l'application:"
	@az webapp show \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP) \
		--query "{Ã‰tat:state, URL:defaultHostName}" -o table 2>/dev/null || echo "âŒ Dashboard non trouvÃ©"
	@echo ""
	@echo "âš™ï¸  Variables configurÃ©es:"
	@az webapp config appsettings list \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP) \
		--query "[?contains(name, 'API_URL')].{API:name, URL:value}" \
		-o table 2>/dev/null || echo "Pas de variables"

# Check santÃ© des 3 services
azure-health:
	@echo "ğŸ¥ VÃ©rification santÃ© des 3 services:"
	@echo ""
	@echo "1ï¸âƒ£  API P8 (VGG16-UNet):"
	@curl -s -w "   Status: %{http_code} - Temps: %{time_total}s\n" \
		$(API_URL_P8_AZURE)/health -o /dev/null || echo "   âŒ Non accessible"
	@echo ""
	@echo "2ï¸âƒ£  API P9 (SegFormer):"
	@curl -s -w "   Status: %{http_code} - Temps: %{time_total}s\n" \
		$(API_URL_P9_AZURE)/health -o /dev/null || echo "   âŒ Non accessible"
	@echo ""
	@echo "3ï¸âƒ£  Dashboard Comparatif:"
	@curl -s -w "   Status: %{http_code} - Temps: %{time_total}s\n" \
		https://$(AZURE_APP_NAME).azurewebsites.net -o /dev/null || echo "   âŒ Non accessible"

# Logs en temps rÃ©el
azure-logs:
	@echo "ğŸ“œ Logs du dashboard (Ctrl+C pour arrÃªter)..."
	az webapp log tail \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP)

# Test du dashboard dÃ©ployÃ©
azure-test:
	@echo "ğŸ§ª Test du dashboard dÃ©ployÃ©..."
	@echo ""
	@echo "1ï¸âƒ£  Test de connectivitÃ©:"
	@curl -s -o /dev/null -w "   HTTP Status: %{http_code} - Temps: %{time_total}s\n" \
		https://$(AZURE_APP_NAME).azurewebsites.net || echo "   âŒ Erreur"
	@echo ""
	@echo "2ï¸âƒ£  Pour test complet:"
	@echo "   ğŸŒ Ouvrez: https://$(AZURE_APP_NAME).azurewebsites.net"
	@echo "   ğŸ“¸ Uploadez une image"
	@echo "   âœ… SÃ©lectionnez P8 et P9"
	@echo "   ğŸš€ Lancez la comparaison"

# ================== GESTION DES CRÃ‰DITS AZURE ==================

# ArrÃªter le dashboard (Ã©conomie)
azure-stop:
	@echo "â¸ï¸  ArrÃªt du dashboard..."
	az webapp stop \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP)
	@echo "âœ… Dashboard arrÃªtÃ© (Ã©conomie de crÃ©dits)"

# RedÃ©marrer le dashboard
azure-start:
	@echo "â–¶ï¸  RedÃ©marrage du dashboard..."
	az webapp start \
		--name $(AZURE_APP_NAME) \
		--resource-group $(AZURE_RESOURCE_GROUP)
	@echo "âœ… Dashboard redÃ©marrÃ©"

# ArrÃªter TOUS les services (P8 + P9 + Dashboard)
azure-stop-all:
	@echo "â¸ï¸  ArrÃªt de TOUS les services P8 + P9..."
	@echo "  ğŸ”¸ ArrÃªt API P8..."
	-@az webapp stop --name oc-p8-segmentation --resource-group rg-p8-segmentation 2>/dev/null
	@echo "  ğŸ”¸ ArrÃªt API P9..."
	-@az webapp stop --name oc-p9-segformer --resource-group $(AZURE_RESOURCE_GROUP) 2>/dev/null
	@echo "  ğŸ”¸ ArrÃªt Dashboard..."
	-@az webapp stop --name $(AZURE_APP_NAME) --resource-group $(AZURE_RESOURCE_GROUP) 2>/dev/null
	@echo ""
	@echo "âœ… Tous les services sont arrÃªtÃ©s (Ã©conomie maximale)"

# RedÃ©marrer TOUS les services
azure-start-all:
	@echo "â–¶ï¸  RedÃ©marrage de TOUS les services..."
	@echo "  ğŸ”¸ DÃ©marrage API P8..."
	-@az webapp start --name oc-p8-segmentation --resource-group rg-p8-segmentation 2>/dev/null
	@echo "  ğŸ”¸ DÃ©marrage API P9..."
	-@az webapp start --name oc-p9-segformer --resource-group $(AZURE_RESOURCE_GROUP) 2>/dev/null
	@echo "  ğŸ”¸ DÃ©marrage Dashboard..."
	-@az webapp start --name $(AZURE_APP_NAME) --resource-group $(AZURE_RESOURCE_GROUP) 2>/dev/null
	@echo ""
	@echo "âœ… Tous les services redÃ©marrÃ©s"
	@echo "â±ï¸  Attendre ~60 secondes pour la disponibilitÃ© complÃ¨te"

# Supprimer le dashboard
azure-destroy:
	@echo "ğŸ—‘ï¸  Suppression du dashboard Azure..."
	@echo "App: $(AZURE_APP_NAME)"
	@read -p "Confirmer la suppression? (oui/non): " confirm; \
	if [ "$$confirm" = "oui" ]; then \
		az webapp delete \
			--name $(AZURE_APP_NAME) \
			--resource-group $(AZURE_RESOURCE_GROUP) \
			--keep-empty-plan; \
		echo "âœ… Dashboard supprimÃ©"; \
	else \
		echo "âŒ Suppression annulÃ©e"; \
	fi

# ================== COMPARAISON & BENCHMARK ==================

# Comparaison avec APIs locales
compare-local:
	@echo "ğŸ“Š Lancement de la comparaison (APIs locales)..."
	@make run-local

# Comparaison avec APIs Azure
compare-azure:
	@echo "ğŸ“Š Lancement de la comparaison (APIs Azure)..."
	@make run-azure

# Benchmark complet
benchmark: test-apis
	@echo "âš¡ Benchmark P8 vs P9..."
	@echo ""
	@echo "ğŸ“Š MÃ©triques thÃ©oriques:"
	@echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
	@echo "â”‚ ModÃ¨le          â”‚ IoU      â”‚ Taille   â”‚ Techniqueâ”‚"
	@echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤"
	@echo "â”‚ VGG16-UNet (P8) â”‚ 0.631    â”‚ 98.8 MB  â”‚ CNN      â”‚"
	@echo "â”‚ SegFormer-B0    â”‚ 0.698    â”‚ 14.5 MB  â”‚ ViT      â”‚"
	@echo "â”‚ SegFormer-B1    â”‚ 0.701    â”‚ 52.5 MB  â”‚ ViT      â”‚"
	@echo "â”‚ SegFormer-B2    â”‚ 0.760    â”‚ 104.9 MB â”‚ ViT      â”‚"
	@echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
	@echo ""
	@echo "Pour benchmark temps rÃ©el: make run-azure"

# ================== NETTOYAGE ==================

# Nettoyage basique
clean:
	@echo "ğŸ§¹ Nettoyage..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	rm -rf .streamlit/
	rm -rf azure_deploy/
	rm -f app.zip
	@echo "âœ… Nettoyage terminÃ©"

# Nettoyage complet
clean-all: clean
	@echo "ğŸ—‘ï¸  Suppression de l'environnement virtuel..."
	rm -rf $(VENV_NAME)
	rm -rf test_images/
	@echo "âœ… Nettoyage complet terminÃ©"

# ================== WORKFLOW SOUTENANCE ==================

# Workflow pour la soutenance
demo-prepare:
	@echo "ğŸ¯ PrÃ©paration de la dÃ©mo pour soutenance..."
	@echo ""
	@echo "1ï¸âƒ£  Installation locale..."
	@make setup
	@echo ""
	@echo "2ï¸âƒ£  VÃ©rification des APIs..."
	@make test-apis
	@echo ""
	@echo "3ï¸âƒ£  DÃ©marrage des services Azure..."
	@make azure-start-all
	@echo ""
	@echo "âœ… SystÃ¨me prÃªt pour la dÃ©monstration!"
	@echo ""
	@echo "ğŸ“Š URLs pour la soutenance:"
	@echo "  P8 API:    $(API_URL_P8_AZURE)"
	@echo "  P9 API:    $(API_URL_P9_AZURE)"
	@echo "  Dashboard: https://$(AZURE_APP_NAME).azurewebsites.net"

# DÃ©mo complÃ¨te
demo-run:
	@echo "ğŸš€ Lancement de la dÃ©mo complÃ¨te..."
	@make azure-start-all
	@sleep 60
	@make azure-health
	@echo ""
	@echo "ğŸŒ Ouvrir: https://$(AZURE_APP_NAME).azurewebsites.net"

# Alias pour compatibilitÃ©
deploy: azure-deploy
status: azure-status
logs: azure-logs

.DEFAULT_GOAL := help